---
sidebar: sidebar 
permalink: task_adm_replace_drives_swraid.html 
keywords: administer, administering, web, software raid, replace drive 
summary: 當使用軟體 RAID 的磁碟機發生故障時， ONTAP Select會使用備用磁碟機（如果有）並自動啟動重建程序。這與FAS和AFF上的ONTAP 的工作方式類似。但是，如果沒有可用的備用驅動器，則需要在ONTAP Select節點中新增一個。 
---
= 更換ONTAP Select發生故障的軟體 RAID 驅動器
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
當使用軟體 RAID 的磁碟機發生故障時， ONTAP Select會指派備用磁碟機（如果有）並自動啟動重建程序。這與ONTAP在FAS和AFF上的工作方式類似。但是，如果沒有可用的備用驅動器，則需要在ONTAP Select節點中新增一個。


NOTE: 移除故障磁碟機和新增磁碟機（標記為備用磁碟機）都必須透過ONTAP Select Deploy 執行。不支援使用 vSphere 將磁碟機連接到ONTAP Select虛擬機器。



== 識別故障驅動器

當磁碟機發生故障時，您需要使用ONTAP CLI 來識別故障磁碟。

[role="tabbed-block"]
====
.虛擬機
--
.開始之前
您必須擁有ONTAP Select虛擬機器的 VM ID，以及ONTAP Select和ONTAP Select Deploy 管理員帳戶憑證。

.關於此任務
僅當ONTAP Select節點在 KVM 上運作並配置為使用軟體 RAID 時才應使用此程序。

.步驟
. 在ONTAP Select CLI 中，確定要更換的磁碟：
+
.. 透過虛擬機器中的序號、UUID 或目標位址識別磁碟。
+
[listing]
----
disk show -fields serial,vmdisk-target-address,uuid
----
.. （可選）顯示已分割磁碟的備用磁碟容量的完整清單。 storage aggregate show-spare-disks


. 在 Linux 命令列介面，找到磁碟。
+
.. 檢查系統設備，搜尋磁碟序號或 UUID（磁碟名稱）：
+
[listing]
----
find /dev/disk/by-id/<SN|ID>
----
.. 檢查虛擬機器配置，搜尋目標位址：
+
[listing]
----
virsh dumpxml VMID
----




--
.ESXi
--
.步驟
. 使用管理員帳戶Sign inONTAP CLI。
. 識別發生故障的磁碟機。
+
[listing]
----
<cluster name>::> storage disk show -container-type broken
Usable Disk Container Container
Disk Size Shelf Bay Type Type Name Owner
---------------- ---------- ----- --- ------- ----------- --------- --------
NET-1.4 893.3GB - - SSD broken - sti-rx2540-346a'
----


--
====


== 移除故障驅動器

確定發生故障的磁碟機後，請移除磁碟。

[role="tabbed-block"]
====
.使用 Deploy 的 KVM
--
您可以在更換磁碟時或不再需要磁碟時將其從 KVM 主機上分離。

.開始之前
您必須擁有ONTAP Select和ONTAP Select Deploy 管理員帳戶憑證。

.步驟
. 使用管理員帳戶Sign in部署公用程式 Web 使用者介面。
. 選擇頁面頂部的“*Clusters*”選項卡，然後從清單中選擇所需的叢集。
. 選擇所需 HA 對或節點旁的 *+*。
+
如果停用該選項，Deploy 目前正在刷新儲存資訊。

. 在*編輯節點儲存*頁面上選擇*編輯儲存*。
. 取消選擇要從節點分離的磁碟，輸入ONTAP管理員憑證，然後選擇 *編輯儲存* 以套用變更。
. 選擇“是”確認彈出視窗中的警告。
. 選擇要監控的叢集的「*事件*」標籤並確認分離操作。
+
如果不再需要該實體磁碟，您可以從主機移除它。



--
.使用 CLI 的 KVM
--
識別磁碟後，請依照下列步驟操作。

.步驟
. 從虛擬機器中分離磁碟：
+
.. 轉儲配置。
+
[listing]
----
virsh dumpxml VMNAME > /PATH/disk.xml
----
.. 編輯檔案並刪除要從虛擬機器分離的磁碟之外的所有內容。
+
磁碟的目標位址應與ONTAP中的 vmdisk-target-address 欄位相對應。

+
[listing]
----
<disk type='block' device='lun'>
  <driver name='qemu' type='raw' cache='directsync'/>
  <source dev='/dev/disk/by-id/ata- Micron_5100_MTFDDAK960TCC_171616D35277'/>
  <backingStore/>
  <target dev='sde' bus='scsi'/>
  <alias name='scsi0-0-0-4'/>
  <address type='drive' controller='0' bus='0' target='0' unit='4'/>
</disk>
----
.. 分離磁碟。
+
[listing]
----
virsh detach-disk --persistent /PATH/disk.xml
----


. 更換物理磁碟：
+
您可以使用諸如此類的工具。 `ledctl locate=`必要時定位物理磁碟。

+
.. 從主機移除磁碟。
.. 如果需要，請選擇新磁碟並將其安裝在主機中。


. 編輯原有磁碟設定文件，新增磁碟。
+
您應該根據需要更新磁碟路徑和任何其他配置資訊。

+
[listing]
----
<disk type='block' device='lun'>
  <driver name='qemu' type='raw' cache='directsync'/>
  <source dev='/dev/disk/by-id/ata-Micron_5100_MTFDDAK960TCC_171616D35277'/>
  <backingStore/>
  <target dev='sde' bus='scsi'/>
  <alias name='scsi0-0-0-4'/>
  <address type='drive' controller='0' bus='0' target='0' unit='4'/>
</disk>
----


--
.ESXi
--
.步驟
. 使用管理員帳戶Sign inDeploy Web 使用者介面。
. 選擇“*Clusters*”標籤並選擇相關集群。
+
image:ST_22.jpg["節點詳細資訊"]

. 選擇 *+* 展開儲存視圖。
+
image:ST_23.jpg["編輯節點存儲"]

. 選擇“*編輯*”對連接的磁碟進行更改並取消選取故障磁碟機。
+
image:ST_24.jpg["存儲磁碟詳細信息"]

. 提供叢集憑證並選擇*編輯儲存*。
+
image:ST_25.jpg["ONTAP 憑證"]

. 確認操作。
+
image:ST_26.jpg["警告"]



--
====


== 新增新的備用驅動器

移除故障磁碟機後，新增備用磁碟。

[role="tabbed-block"]
====
.使用 Deploy 的 KVM
--
.使用 Deploy 附加磁碟
您可以將磁碟連接到 KVM 主機，作為更換磁碟的一部分或增加更多儲存容量。

.開始之前
您必須擁有ONTAP Select和ONTAP Select Deploy 管理員帳戶憑證。

新磁碟必須實體安裝在 KVM Linux 主機上。

.步驟
. 使用管理員帳戶Sign in部署公用程式 Web 使用者介面。
. 選擇頁面頂部的“*Clusters*”選項卡，然後從清單中選擇所需的叢集。
. 選擇所需 HA 對或節點旁的 *+*。
+
如果停用該選項，Deploy 目前正在刷新儲存資訊。

. 在*編輯節點儲存*頁面上選擇*編輯儲存*。
. 選擇要連接到節點的磁碟，輸入ONTAP管理員憑證，然後選擇 *編輯儲存* 以套用變更。
. 選擇“*事件*”標籤來監視並確認附加操作。
. 檢查節點儲存配置以確認磁碟已連接。


--
.使用 CLI 的 KVM
--
識別並移除故障磁碟機後，您可以連接新的磁碟機。

.步驟
. 將新磁碟附加到虛擬機器。
+
[listing]
----
virsh attach-disk --persistent /PATH/disk.xml
----


.結果
該磁碟已分配為備用磁碟，可供ONTAP Select使用。該磁碟可能需要一分鐘或更長時間才能變為可用狀態。

.完成後
由於節點配置已更改，您應該使用 Deploy 管理公用程式執行叢集刷新操作。

--
.ESXi
--
.步驟
. 使用管理員帳戶Sign inDeploy Web 使用者介面。
. 選擇“*Clusters*”標籤並選擇相關集群。
+
image:ST_27.jpg["HA 對"]

. 選擇 *+* 展開儲存視圖。
+
image:ST_28.jpg["編輯節點存儲"]

. 選擇*編輯*並確認新磁碟機可用並選擇它。
+
image:ST_29.jpg["存儲磁碟詳細信息"]

. 提供叢集憑證並選擇*編輯儲存*。
+
image:ST_30.jpg["存儲磁碟詳細信息"]

. 確認操作。
+
image:ST_31.jpg["存儲磁碟詳細信息"]



--
====